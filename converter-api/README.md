# PDF to Voice converter: Converter-API

Converter-API является микросервисом, составной частью проекта 
[PDF to Voice converter](https://github.com/he1ex-tG/PDF-to-Voice-Converter).

## Структура

Данный микросервис предоставляет третьим лицам, а также микросервисам из этого проекта 
[API](#1-api) для [конвертирования](#2-конвертер) PDF файлов в MP3.

### 1. API

Предоставляемое микросервисом API создано на базе [Spring Boot](https://spring.io/projects/spring-boot) и 
предлагает следующие end-point:

| __Тип запроса__ | __Путь__          | __MIME на входе__          | __MIME на выходе__         | __Описание__                                                                                         |
|-----------------|-------------------|----------------------------|----------------------------|------------------------------------------------------------------------------------------------------|
| POST            | /api/v1/converter | `application/octet-stream` | `application/octet-stream` |  Конвертировать `ByteArray` из тела запроса, содержащий PDF файл, в `ByteArray`, содержащий MP3 файл |

Единственного end-point достаточно, чтобы данный микросервис мог быть применен в рамках проекта. В целях 
расширения функциональных возможностей, неплохо смотрится вариант с добавлением end-point для 
конвертирования текста, а также усложнения структуры тела запроса или добавления дополнительных параметров,
передаваемых при обращении к API (например, указание скорости воспроизведения, мужской/женский голос и 
т.д.).  

Все end-point не защищены посредством использования 
[Spring Security](https://spring.io/projects/spring-security), поэтому являются
общедоступными. Такой подход выбран в первую очередь затем, чтобы показать гибкость микросервисной 
архитектуры. К данному модулю без авторизации могут обращаться как другие модули проекта 
([PDF to Voice converter: Processor](https://github.com/he1ex-tG/PDF-to-Voice-Converter/tree/master/processor)), 
так и третьи лица согласно своим потребностям.

### 2. Конвертер

Процесс конвертирования PDF файла в звуковой выполняется в несколько идущих друг за другом действий, а именно:
1. PDF файл преобразуется в текстовый (массив байтов) с использованием функциональных возможностей библиотеки 
[ITextPDF](https://itextpdf.com/).
2. Текст передается методам библиотеки [FreeTTS](https://freetts.sourceforge.io/), где он преобразуется в звуковой формат MP3.
    
    > __Заметка__
    > 
    > В стандартной реализации функциональные возможности библиотеки [FreeTTS](https://freetts.sourceforge.io/) не предоставляют возможность получить на выходе звуковой поток в формате MP3 (только WAV), а также в виде `ByteArrayInputStream` или `ByteArray`. Для устранения указанных неудобств была создана собственная реализация интерфейса `AudioPlayer`, которая позволила избежать премежуточного сохранения данных в файл, а также конвертировать WAV в MP3 "на лету", используя методы библиотеки [Lame](https://lame.sourceforge.io/). 

Откровенно говоря, голос, который дает на выходе библиотека [FreeTTS](https://freetts.sourceforge.io/), оставляет желать лучшего. Однако 
этого в общем и целом достаточно для данного проекта. Для внесения изменений в процесс конвертирования
достаточно создать новую реализацию интерфейса `ConverterService`.

## Технологии

1. [Spring Boot](https://spring.io/projects/spring-boot)
2. [ITextPDF](https://itextpdf.com/)
3. [FreeTTS](https://freetts.sourceforge.io/)
4. [Lame](https://lame.sourceforge.io/)
